## Установка Seed ноды с нуля
Так как писал скрипты для себя, то не ищите в них идеальности, скорее даже очень наоборот.
Запуск ноды VIZ сводится к нескольким простым действиям:

1. Установка Docker. Для этого достаточно запустить скрипт — **docker_install.sh**.
Если Docker не используется, переходим к пункту 3.

2. Запуск контейнера на базе образа ubuntu 16.04 — **docker_viz_run.sh**.

3. Запуск внутри контейнера или локально — **1_zero_build_viz.sh**, для сборки vizd, предварительно указав значения переменных для путей в **config.sh**.

4. Запуск vizd — **3_vizd-resync.sh**. Если после запуска нода ничего не делает, то скорее всего необходимо обновить список сид нод в **config.ini**.

5. После удачного запуска, если все работает хорошо, нужно остановить vizd, выйти из контейнера и сохранить, коммитом, получившийся контейнер в новый образ, что бы сохранить все изменения в нем: **docker commit id new_image_name**. После этого в скрипте  **docker_viz_run.sh** нужно заменить имя образа **1and1internet/ubuntu-16** на то, которое вы дадите при сохранении коммита.

Не поленитесь и прочитайте хотя бы пояснения в скриптах.

### Установка Docker
Данная инструкция подготавливалась для сборки под Ubuntu 16.04, так как на более свежих выпусках сборка будет неудачной из-за более свежей libboost, нужна версия не выше 1.58

Если производится локальная установка без Docker, то этот раздел можно пропустить и перейти к разделу **Сборка vizd из исходных кодов**.

Обновляем пакетную базу, устанавливаем необходимые пакеты:

    $ sudo apt update && sudo apt -y install apt-transport-https ca-certificates curl software-properties-common

Добавляем репозиторий Docker-а:

    $ sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
    $ sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"

Устанавливаем Docker:

    $ sudo apt update && apt install -y docker-ce

Все эти действия можно сделать 1 скриптом **docker_install.sh**

По умолчанию все команды Docker запускаются от рута. Что бы каждый раз не набирать пароль, добавляем себя в группу docker:

    $ sudo usermod -aG docker user_name
    $ sudo su - user_name
    $ id -nG
    user adm cdrom sudo dip plugdev lxd lpadmin sambashare docker

Если вывод последней команды покажет что вы не в группе docker, то нужно перезайти в систему и проверить еще раз, повторив команду **id -nG**.

###Запуск контейнера для vizd
Запуск контейнера производится командой:

    docker run -i -t -v /mnt/files/viz:/viz 1and1internet/ubuntu-16 bash

Будет скачен образ **1and1internet/ubuntu-16:latest** и на его базе запущен контейнер. Если вы не доверяете этому образу, можете использовать любой другой, предварительно изменив скрипт. Так же будет смонтирован локальный каталог /mnt/files/viz внутрь нашего контейнера в каталог /viz. После запуска контейнера вы попадёте в его командную строку и увидите примерно следующее:

    root@4a7549c66e8a:/#

Что означает что контейнер запущен и вы находитесь в нем.
Проверяем, смонтировался ли наш каталог:

    # ls -l
    …
    drwxr-xr-x   1 1000 1000  220 Oct 11 10:09 viz

Если вы заранее скопировали скрипты в **/mnt/files/viz** то они должны быть доступны в контейнере:

    root@4a7549c66e8a:/# ls -l /viz
    total 20
    -rwxrw-r-- 1 1000 1000 3326 Oct 11 09:38 1_zero_build_viz.sh
    -rwxr--r-- 1 1000 1000  511 Oct 11 09:38 2_rebuild_viz.sh
    -rwxr--r-- 1 1000 1000  335 Oct 11 09:38 3_vizd-resync.sh
    -rwxr--r-- 1 1000 1000  335 Oct 11 09:38 4_vizd-replay.sh
    -rw-rw-r-- 1 1000 1000  623 Oct 11 09:38 config.sh

Если ещё не копировали, то самое время это сделать.

Добавьте в команду запуска ключ --rm, если хотите, что бы контейнер удалился после его остановки:

    docker run -i -t -v /mnt/files/viz:/viz --rm 1and1internet/ubuntu-16 bash

### Сборка vizd из исходных кодов
Копируем сборочные скрипты и скрипты запуска в соответствующие места.
Для сборки в Docker:

    /mnt/files/viz

Для локальной сборки:

    /home/user/viz

Первым делом нужно определиться с переменными в файле **config.sh**.
В зависимости от типа сборки, вам нужно указать соответствующие пути для переменных.
**WORKDIR** — переменная определяющая место хранения исходных кодов vizd и работающего блокчейна после сборки.
**WORKDIR_SWAP** — место расположения файла подкачки.
Для сборки в Docker переменные уже имеют заданные значения и нет необходимости что-либо менять:

    WORKDIR='/viz'
    WORKDIR_SWAP='/viz'

Для локальной сборки рекомендуется указать следующие значения:

    WORKDIR='/home/user/viz'
    WORKDIR_SWAP='/'

Для этого достаточно раскомментировать соответствующие строки в файле **config.sh** и закомментировать переменные для Docker.

Далее описан процесс который идентичен для обоих вариантов сборки, локальной и в Docker. Переходим в каталог viz:

    # root@4a7549c66e8a:/# cd viz

Запускаем файл **1_zero_build_viz.sh** и наблюдаем процессы установки необходимых зависимостей и сборки vizd:

    # root@4a7549c66e8a:/viz# ./1_zero_build_viz.sh

В процессе работы скрипта появится запрос на установку вашего часового пояса, где нужно выбрать географическое расположение и ваш регион или город. Если по какой-то причине вы неправильно настроили часовые пояса то перезапустить настройку можно командой:

    # root@4a7549c66e8a:/# sudo dpkg-reconfigure tzdata

Если сборка прошла удачно вы увидите следующее:

    -- Configuring done
    -- Generating done
    -- Build files have been written to: /viz/viz-world/build
    nohup: ignoring input and redirecting stderr to stdout
    nohup: ignoring input and redirecting stderr to stdout

Запускаем vizd:

    root@4a7549c66e8a:/viz# ./3_vizd-resync.sh

Подключаемся к запущенной сессии:

    root@4a7549c66e8a:/viz# screen -x vizd

Если все было сделано правильно, то начнётся синхронизация блоков:

    3426295ms            p2p_plugin.cpp:143            handle_block         ] Got 0 transactions on block 354240 by litrbooh -- latency: 295 ms
    3429262ms            p2p_plugin.cpp:143            handle_block         ] Got 0 transactions on block 354241 by retroscope -- latency: 262 ms
    3432139ms            p2p_plugin.cpp:143            handle_block         ] Got 0 transactions on block 354242 by asuleymanov -- latency: 139 ms
    3435294ms            p2p_plugin.cpp:143            handle_block         ] Got 0 transactions on block 354243 by t3ran13 -- latency: 294 ms

И через какое-то время обмен с другими нодами.

Для отключения с сохранением работающей сессии необходимо нажать  **Ctr+A+D**.
При дальнейшей работе могут возникнуть ситуации, при которых необходимо сделать проверку базы блокчейна на целостность, для этого предназначен скрипт **4_vizd-replay.sh**:

    root@4a7549c66e8a:/viz# ./4_vizd-replay.sh

